apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: zerossl-prod
  namespace: cert-manager
spec:
  acme:
    # The ACME server URL
    server: https://acme.zerossl.com/v2/DV90
    externalAccountBinding:
      keyID: fY3FgZdzCS5UO2gEsnavbw
      keySecretRef:
        name: zerossl-eabsecret
        key: secret
    # Name of a secret used to store the ACME account private key
    privateKeySecretRef:
      name: zerossl-prod
    solvers:
      - http01:
          ingress:
            class: nginx
        selector:
          matchLabels:
            "use-http-solver": "true"
      - dns01:
          webhook:
            groupName: acme.${COMPANY_DOMAIN}
            solverName: pdns
            config:
              zone: ${SECRET_DOMAIN}
              secretName: pdns-secret
              zoneName: ${SECRET_DOMAIN}.
              apiUrl: https://ns1.${COMPANY_DOMAIN}
        selector:
          dnsZones:
            - "${SECRET_DOMAIN}"
