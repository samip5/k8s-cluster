---
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: inject-private-registry-secret
  annotations:
    policies.kyverno.io/title: Add private pull secret
    policies.kyverno.io/category: Other
    policies.kyverno.io/subject: Pod
spec:
  mutateExistingOnPolicyUpdate: true
  generateExistingOnPolicyUpdate: true
  rules:
    - name: inject-secret
      match:
        all:
          - resources:
              kinds:
                - Pod
          - resources:
              namespaces:
                - ahmia-search
      mutate:
        patchesJson6902:
          - target:
              group: ""
              kind: Pod
              name: $.name
            patch: |-
              - op: add
                path: /spec/imagePullSecrets/-
                value:
                  name: privateregistry



