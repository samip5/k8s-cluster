---
clusterName: nebula
# renovate: depName=ghcr.io/siderolabs/installer datasource=docker
talosVersion: v1.7.5
# renovate: depName=ghcr.io/siderolabs/kubelet datasource=docker
kubernetesVersion: v1.30.2

cniConfig:
  name: none

endpoint: https://10.0.105.10:6443
domain: nebula.local
allowSchedulingOnMasters: true
additionalMachineCertSans:
  - "127.0.0.1"
additionalApiServerCertSans:
  - nebula.local
  - cluster.local
clusterPodNets:
  - 10.244.0.0/16
  - fddf:f7bc:9670::/48
clusterSvcNets:
  - 10.96.0.0/12
  - 2001:14ba:74ae:3405::1e:0/112


nodes:
  - hostname: m1
    ipAddress: 10.0.105.34
    controlPlane: true
    installDiskSelector:
      busPath: /pci0000:00/0000:00:17.0/ata1/host0/target0:0:0/0:0:0:0/
    disableSearchDomain: true
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: 6c:4b:90:2d:a7:dd
        dhcp: true
        vip:
          ip: 10.0.105.10
  - hostname: w-amd-1
    ipAddress: 10.0.105.50
    controlPlane: false
    installDiskSelector:
      busPath: /pci0000:00/0000:00:17.0/ata1/host0/target0:0:0/0:0:0:0/
    disableSearchDomain: true
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: 6c:4b:90:2d:a8:07
        dhcp: true
  - hostname: w-amd-2
    ipAddress: 10.0.105.28
    controlPlane: false
    installDiskSelector:
      size: "<= 300GB"
      busPath: /pci0000:00/0000:00:1f.2/ata2/host1/target1:0:0/1:0:0:0/
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: d8:cb:8a:1d:a0:d2
        dhcp: true
  - hostname: w-amd-3
    ipAddress: 10.0.105.19
    controlPlane: false
    installDiskSelector:
      busPath: /pci0000:00/0000:00:17.0/ata1/host0/target0:0:0/0:0:0:0/
    disableSearchDomain: true
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: ec:8e:b5:7b:ef:aa
        dhcp: true
    install:
      image:
  - hostname: w7
    ipAddress: 10.0.105.29
    controlPlane: false
    installDiskSelector:
      wwid: naa.5002538f4173a3bc
    disableSearchDomain: true
    networkInterfaces:
      - deviceSelector:
          hardwareAddr: d8:3a:dd:d8:70:bc
        dhcp: true

patches:
  - "@./patches/global/cluster-discovery.yaml"
  - "@./patches/global/containerd.yaml"
  - "@./patches/global/disable-search-domain.yaml"
  - "@./patches/global/kubelet.yaml"
  - "@./patches/global/nfs.yaml"
  - "@./patches/global/sysctl.yaml"
  - "@./patches/global/udev.yaml"

controlPlane:
  patches:
    - "@./patches/controller/api-access.yaml"
    - "@./patches/controller/cluster.yaml"
    - "@./patches/controller/disable-admission-controller.yaml"
    - "@./patches/controller/kube-prism.yaml"


